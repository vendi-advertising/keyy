function keyy_inject_code_into_form(e,o,r){var n=jQuery,i=Keyy.get_login_token();if("undefined"==typeof r){if(keyy.is_disabled)return n(e).prepend('<div class="keyy_qrcode_container_disabled">'+keyy.disabled+"</div>"),void(Keyy.parse_query_string.hasOwnProperty("keyy_disable")&&n(e).prepend('<input type="hidden" name="keyy_disable" value="'+Keyy.parse_query_string.keyy_disable+'">'));var s='<div class="keyy_qrcode_container"';keyy.stealth_mode&&(s+=' style="display:none;"'),s+='><div class="keyy_qrcode" data-keyy_form_identifier="'+o+'"></div>',keyy.what_is_this_answer&&(s+='<div class="keyy_qrcode_descriptor"><a href="#" class="keyy_qrcode_explanation">'+keyy.what_is_this+"</a></div>"),s+="</div>",n(e).prepend(s)}var t=e+" .keyy_qrcode";if(Keyy.show_qr_code(t,"login"),i.hasOwnProperty("origin")&&"autologin"==i.origin&&i.hasOwnProperty("password_policy")&&"required"==i.password_policy){if(i.hasOwnProperty("user_login")){var y=n("form .keyy_qrcode").first().closest("form");y.find('input[name="log"], input[name="username"], input[name="affwp_user_login"]').val(i.user_login).prop("readonly",!0),y.find(".keyy_qrcode").html(keyy.authorised_needs_password)}return void console.log("Keyy: user policy requires a password. Will not auto-submit form.")}Keyy.register_listener("login",function(e,o){if(e.hasOwnProperty("state")&&"claimed"==e.state){var r;if(r=e.hasOwnProperty("form_id")&&e.form_id?n('.keyy_qrcode[data-keyy_form_identifier="'+e.form_id+'"]').closest("form"):n("form .keyy_qrcode").first().closest("form"),r.length<1)return alert(keyy.login_form_not_found),void console.log(e);if(r.find('input[name="log"], input[name="username"], input[name="affwp_user_login"]').val(e.user_login).prop("readonly",!0),r.find('input[type="checkbox"][name="rememberme"]').prop("checked",!0),r.prepend('<input type="hidden" name="keyy_token_id" value="'+o.value+'">'),e.hasOwnProperty("password_policy")&&"required"==e.password_policy){var i=r.find('input[name="pwd"], input[name="password"], input[name="pass"]');if(i.length&&!i.val())return console.log("Keyy: user policy requires a password, and none yet entered. Will not auto-submit form."),r.find(".keyy_qrcode").html(keyy.authorised_needs_password),!0}return console.log("Keyy: submitting: token_id="+o.value+" user_login="+e.user_login),r.submit(),!0}e.hasOwnProperty("state")&&"unused"==e.state||(console.log("Keyy: login listener responded, but not for a login:"),console.log(e))})}jQuery(document).ready(function(e){var o=0;if(e.each(keyy.hook_forms,function(r,n){var i=n.selector;e(i).length<1||(keyy_inject_code_into_form(i,o+1),!keyy.is_disabled&&n.hasOwnProperty("hide")&&n.hide&&e(n.hide).hide(),o++)}),e("form").on("click",".keyy_qrcode_container a.keyy_qrcode_explanation",function(o){o.preventDefault(),e(this).parent().hide().html(keyy.what_is_this_answer).fadeIn("slow")}),keyy.stealth_mode){e("body").focus().blur();var r=function(o){if(o.hasOwnProperty("which")&&107==o.which){var n=o.target.tagName.toLowerCase();"input"!=n&&"textarea"!=n&&(e(".keyy_qrcode_container").fadeToggle("slow"),e("body").off("keypress",r))}};e("body").keypress(r)}});